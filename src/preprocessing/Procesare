import os
import cv2
import numpy as np

raw = r"D:\Facultate\RN\docs\raw\Lung X-Ray Image"
procesate = r"D:\Facultate\RN\docs\processed"

target_size = (224, 224)

def preprocess_image(img_path):
    img = cv2.imread(img_path)
    if img is None:
        print(f"Nu s-a putut citi imaginea: {img_path}")
        return None
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    clahe = cv2.createCLAHE(clipLimit=2.0, tileGridSize=(8, 8))
    gray = clahe.apply(gray)
    gray = gray / 255.0 
    image = transform.resize(gray, (224,224), mode="symmetric", preserve_range=True)
    return image

def saveImg(gray, save_path):
    cv2.imwrite(save_path, (gray * 255).astype(np.uint8))

for class_name in ["Normal", "Viral Pneumonia"]:
    class_input_dir = os.path.join(raw, class_name)
    class_output_dir = os.path.join(procesate, class_name)
    
    os.makedirs(class_output_dir, exist_ok=True)

    for filename in os.listdir(class_input_dir):
        if filename.endswith(".jpg"):
            input_path = os.path.join(class_input_dir, filename)
            output_path = os.path.join(class_output_dir, filename)

            imgprocesata = preprocess_image(input_path)
            if imgprocesata is not None:
                saveImg(imgprocesata, output_path)
print("Procesare finalizatÄƒ!")
